meta :copy do
  accepts_value_for :source
  accepts_value_for :path
  accepts_value_for :username

  template do
    met? do
      puts 'AAAAAA'
      puts !path.p.exists?
      puts !shell?("grep '# Generated by babushka' #{path}")
      puts shell?("diff -I '# Generated by babushka' #{s} #{path}")

      next false if !path.p.exists?
      next true  if !shell?("grep '# Generated by babushka' #{path}")

      shell?("diff -I '# Generated by babushka' #{s} #{path}")
    end

    meet do
      render_erb source, to: path
      shell "chown #{u}:#{u} #{path}"
    end

    def u
      username.nil? ? 'root' : username
    end

    def s
      erb_path_for source
    end
  end
end
